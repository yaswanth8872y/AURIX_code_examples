<img src="./Images/IFX_LOGO_600.gif" align="right" width="150" />  

# iLLD_TC4D7_LK_ADS_EGTM_ATOM_3_Phase_Inverter_PWM_1 
 
**The EGTM ATOM is configured to generate a PWM signals for two-level three phase inverter. The TriCore&trade; is used as a host for the driver.**  

## Device  
The device used in this example is AURIX&trade; TC4D7XP_A-Step_MC_COM.  

## Board  
The board used for testing is the AURIX&trade; TC4D7 Lite Kit (KIT_A3G_TC4D7_LITE).  

## Scope of work  
The states of the 6 pins are controlled by the PWM signals generated by the Enhanced Generic Timer
Module (EGTM) in-built ARU-Connected Timer Output Module (ATOM). All signals are synchronous to each
other, center-aligned and with dead-times (positive/negative) for the complementary pairs.

## Introduction  
EGTM is an enhanced instance of the Generic Timer Module (GTM), a universal timer architecture provided by Bosch AE.

The EGTM module is capable of driving different kinds of pulse-width-modulation (PWM) with and without
dead-time. It is optimized for electrical drive applications.


The ARU-connected Timer Output Module (ATOM), which is part of the EGTM, is able to generate complex output signals.

The Clock Management Unit (CMU) is responsible for clock generation of the EGTM. The Configurable Clock Generation Subunit (CFGU) provides eight clock sources for the EEGTM submodules: TIM, TBU, MON and ATOM.


## Hardware setup  
This code example has been developed for the board TC4D7 Lite Kit board (KIT_A3G_TC4D7_LITE):

<img src="./Images/EvalKit_AURIX_TC4x7_Lite_V1_TOP.png" width="800" />  

## Implementation  

**EGTM configuration** 
   
The *IfxEgtm_Pwm.h* iLLDs provide the EGTM PWM driver to configure required peripheral resources and drive them to produce the PWM waveform.
PWM drivers are initialized and driven by the  TriCore&trade; core.
  
The *initEgtmAtom3phInv()* configuration sequence is the following:
* Initialization of the EGTM Module
* Configuration of the CMU-CLOCK0 for the ATOM usage
* Configuration of the PWM channel groups to produce 3 complementary pair signals
* Initialization of the drivers  

Following PWM characteristics are enabled/configured with this example:

<table>
    <tbody>
        <tr>
            <td><b>PWM Type</b></td>
            <td>Center Aligned</td>
        </tr>
        <tr>
            <td><b>Frequency</b></td>
            <td>20 kHz</td>
        </tr>
        <tr>
            <td><b>Polarity</b></td>
            <td>Duty-On High</td>
        </tr>
        <tr>
            <td><b>Complementary Output</b></td>
            <td>Enabled (opposite polarity)</td>
        </tr>
        <tr>
            <td><b>DTM enabled</b></td>
            <td>
                <table>
                    <tbody>
                        <tr>
                            <td><b>Channel</b></td>
                            <td><b>Rising Edge</b></td>
                            <td><b>Falling Edge</b></td>
                        </tr>
                        <tr>
                            <td>CH0</td>
                            <td>1uS</td>
                            <td>1uS</td>
                        </tr>
                        <tr>
                            <td>CH1</td>
                            <td>1uS</td>
                            <td>1uS</td>
                        </tr>
                        <tr>
                            <td>CH2</td>
                            <td>1uS</td>
                            <td>1uS</td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    </tbody>
</table>



The table below provides the mapping between the PWM signal and the Port Pins:  

<table>
    <tbody>
        <tr>
            <td><b>&emsp;PWM Signal</b></td>
            <td><b>&emsp;Pin Mapping</b></td>
        </tr>
        <tr>
            <td>&emsp;<span style="color:blue">PHASE_U_HS</span></td>
            <td>&emsp;<span style="color:blue">P20.8</span></td>
        </tr>
        <tr>
            <td>&emsp;<span style="color:blue">PHASE_U_LS</span></td>
            <td>&emsp;<span style="color:blue">P20.9</span></td>
        </tr>
        <tr>
            <td>&emsp;<span style="color:green">PHASE_V_HS</span></td>
            <td>&emsp;<span style="color:green">P20.10</span></td>
        </tr>
        <tr>
            <td>&emsp;<span style="color:green">PHASE_V_LS</span></td>
            <td>&emsp;<span style="color:green">P20.11</span></td>
        </tr>
        <tr>
            <td>&emsp;<span style="color:red">PHASE_W_HS</span></td>
            <td>&emsp;<span style="color:red">P20.12</span></td>
        </tr>
        <tr>
            <td>&emsp;<span style="color:red">PHASE_W_LS</span></td>
            <td>&emsp;<span style="color:red">P20.13</span></td>
        </tr>
    </tbody>
</table>

**EGTM update**   
 
Once the EGTM is configured and started, a duty cycle update is performed every 500ms in the *updateEgtmTom3phInvDuty()* function:

1. Each channel **x** is cyclically modified with 10% increment duty cycle from 0% till 100% using the variable *g_egtmAtom3phInv.dutyCycles[***x***]* 
2. The duty cycle of all channels is then updated at once using the iLLD function *IfxEgtm_Pwm_updateChannelsDutyImmediate()*
3. To indicate the correct functionning of the application, the LED (P03.9) is toggled once in a second using the iLLD function *IfxPort_togglePin()*

## Compiling and programming
Before testing this code example:  
- Power the board through the dedicated power connector 
- Connect the board to the PC through the USB interface
- Build the project using the dedicated Build button <img src="./Images/build_activeproj.gif" /> or by right-clicking the project name and selecting "Build Project"
- To flash the device and start a debug session, click on the Debug button <img src="./Images/debug.gif" /> and create a configuration for a debugger (double clicking on the debugger name, a default configuration is created)


## Run and Test   

After code compilation and flashing the device, observe the LED (P03.9), which should be toggling with the PWM_FREQUENCY.

<img src="./Images/LED_Blinking.jpg" width="800" />  

The PWM signals can be observed using a logic analyzer or an oscilloscope connected to the pins shown in the picture above.  
The following video shows the generated PWM signals:

<video width="800" height="321" controls>
  <source src="./Images/PWM_Signals_3PH_ADC_Trig.mp4" type="video/mp4"/>
</video>  

Legend:  
<span style="color:blue">D0: PHASE_U_HS</span>  
<span style="color:blue">D1: PHASE_U_LS</span>  
<span style="color:green">D2: PHASE_V_HS</span>  
<span style="color:green">D3: PHASE_V_LS</span>  
<span style="color:red">D4: PHASE_W_HS</span>  
<span style="color:red">D5: PHASE_W_LS</span>  

## References  

AURIX&trade; Development Studio is available online:  
- <https://www.infineon.com/aurixdevelopmentstudio>  
- Use the "Import..." function to get access to more code examples  

More code examples can be found on the GIT repository:  
- <https://github.com/Infineon/AURIX_code_examples>  

For additional trainings, visit our webpage:  
- <https://www.infineon.com/aurix-expert-training>  

For questions and support, use the AURIX&trade; Forum:  
- <https://community.infineon.com/t5/AURIX/bd-p/AURIX> 
